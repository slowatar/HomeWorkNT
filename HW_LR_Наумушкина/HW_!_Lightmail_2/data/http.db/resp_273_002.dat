/**
 * Mail.ru RBAdman-HTML5
 * Release date: 2021-05-12
 * Version: 2.1.75
 */
AdmanHTML=function(){"use strict";function a(a){V.initMode(a.slot?"slot":"json",{slot:a.slot,version:R.version}),R.slotId=a.slot,R.playerEl=a.playerEl,R.wrapper=a.wrapper,R.videoEl=a.videoEl,R.audioEl=a.audioEl,R.clickEl=a.clickEl,R.quality=parseInt(a.videoQuality||a.params&&a.params.videoQuality||360,10),R.browser=a.browser||{},R.config=a.config||{},R.pauseOnHide=a.pauseOnHide||!1,R.viewabilityValue=a.viewabilityValue||.5,R.viewabilityEl=a.viewabilityEl||R.videoEl;var b=AdmanHTML.Utils.getPageLocation(),c=AdmanHTML.Utils.getHostname(b||"");R.location={top:b,topEncoded:encodeURIComponent(b||""),hostname:c,hostnameEncoded:encodeURIComponent(c||"")},V.rb(V.code.ADMAN_SUCCESSFULLY_INITIALIZED),Y=a.midrollPointsP||null,X=!Y&&a.midrollPoints?a.midrollPoints:null,R.config.vpaidJsInterface||(R.config.vpaidJsInterface=T),R.config.vpaidHtmlInterface||(R.config.vpaidHtmlInterface=U);var d="https://ad.mail.ru/vp/"+R.slotId+"?version="+this.getVersion();if(a.params&&a.params.constructor&&a.params.constructor===Object){var e=[];"flash"in a.params||(a.params.flash=AdmanHTML.Utils.checkFlash()?1:0);for(var f in a.params)a.params.hasOwnProperty(f)&&e.push(f+"="+a.params[f]);var g=AdmanHTML.Utils.getUserIdQuery();g&&e.push(g),e.length&&(d+="&"+e.join("&"))}if((R.slotId||a.json||a.adUrl)&&!R.browser.adBlock){var h={},i=this;R.slotId?h.url=d:a.adUrl?(-1!==a.adUrl.indexOf("ad.mail.ru/")&&(a.adUrl+=-1===a.adUrl.indexOf("?")?"?":"&",a.adUrl+="version="+this.getVersion()),h.url=a.adUrl):h.data=a.json,K=new AdmanHTML.AdSlot(R,h,function(){var b=K.getRootSettings().requestHostname;if(b&&!AdmanHTML.Utils.matchHostname(R.location.hostname,b))return R.stats.logError("HOSTNAME_MISMATCH:"+b+":"+R.location.topEncoded),void(R.callbacks.onError&&R.callbacks.onError());R.location.hostname||R.stats.logError("HOSTNAME_EMPTY:"+b+":"+R.location.topEncoded),R.cb("onReady",[{settings:K.settings}]);var c=1e6,d=[],e=[],f=a.params&&a.params.duration?parseInt(a.params.duration,10):c;0===f&&(f=c),X&&X.sort(AdmanHTML.Utils.numSorter),Y&&Y.sort(AdmanHTML.Utils.numSorter);var g=K.getSection("midroll")||[],h=K.getServices("midroll",function(a){return!a.started()&&a.isAfter()})||[];g=g.concat(h),g.forEach(function(a){var b=a.getAd();b.point||b.pointP||(b.pointP=50)}),g.sort(function(a,b){var c=a.getAd(),d=b.getAd();return c.pointP&&d.pointP?c.pointP-d.pointP:(c.point||c.pointP/100*f)-(d.point||d.pointP/100*f)}).forEach(function(a){if(!a.isEmpty||!a.isEmpty()){var b=a.getAd();X&&X.length?(b.point=X.shift(),b.pointP=null,e.push(b.point),a.addImmutableProperty("point",b.point)):Y&&Y.length?(b.pointP=Y.shift(),b.point=null,d.push(b.pointP),a.addImmutableProperty("pointP",b.pointP)):X||Y||(b.point?(a.addImmutableProperty("point",b.point),e.push(b.point)):b.pointP&&(a.addImmutableProperty("pointP",b.pointP),d.push(b.pointP)))}}),$=d.sort(AdmanHTML.Utils.numSorter),Z=e.sort(AdmanHTML.Utils.numSorter);var j=K.getSection("research");j&&j.length>0&&(P=j[0]),R.pauseOnHide&&I(i)})}else{V.logError("Adman init failed");var j=R.callbacks.onError;j&&j(),N=M=L=null}}function b(a){var b;N&&(N.log("sectionShown"),N.disposed||(N.dispose(),N.disposed=!0,s(N,L)),a&&N.log("closedByUser")),L&&!ea[L]&&(ea[L]="midroll"!==L,b=a?R.callbacks.onClosed:R.callbacks.onCompleted),ca[L]&&M&&(ca[L]=ca[L].concat(M.splice(0,M.length))),N=M=L=null,f(),b&&b()}function c(){var a=K.getSettings(L).maxBannersShow||0,d=ba[L]||0,e=!a||d<a;if(N&&!N.disposed&&(N.complete&&N.log("playbackCompleted"),N.dispose(),N.disposed=!0,s(N,L)),M&&M.length&&e)N=M.shift(),ba[L]=d+(N.isEmpty()?0:1),N.reset(),N.started=!0,N.start();else{var f=K.getNextAfterService(L);"midroll"!==L&&f&&e?f.start(function(){M=K.getSection(L),c()}):K.getSettings(L).loop&&ca[L]&&ca[L].length?(M=ca[L],ca[L]=[],c()):b()}}function d(a){M||(L=a||"preroll",K.resetServices(L),ea[L]=!1,M=K.getSection(L),"midroll"===a&&(M=h(M)),c(),L&&(ca[L]=ca[L]||[]),N&&(N.log("sectionStarted"),R.debugMode&&console.log(L,N.getAd(),N.getSettings(),M)),e(L))}function e(a){(O=K.getDebug(a))&&O.start()}function f(){O&&O.dispose(),O=null}function g(a,b){function c(a,b){for(var c=0;c<a.length&&!(Math.abs(a[c])>b);c++);return c>0?[a[c-1]]:[]}function d(a){var b=a.getAd();return!(b.point&&-1===Z.indexOf(b.point)||b.pointP&&-1===$.indexOf(b.pointP))&&(b.point&&b.point<=j||b.pointP&&b.pointP<=k)}if(!isNaN(a)&&!isNaN(b)){var e=parseInt(a),f=Math.floor(100*a/b);Q=b,_=$&&isFinite(f)?c($,f):[],aa=Z?c(Z,e):[],_[0]&&aa[0]&&(Math.abs(_[0]*Q/100)>Math.abs(aa[0])?aa=[]:_=[]);var g=K.getSettings("midroll").midpointAllowableDelta;da=void 0!=g?g:da;var h=100*da/b,i=0!==da&&da<5?da:5,j=e+i,k=f+i/b*100;if(K.getServices("midroll",function(a){return!(!a.isAfter()||a.started()||!d(a))}).forEach(function(a){K.removeService(a);var b=e-a.getAd().point,c=f-a.getAd().pointP;b<da||c<h||0===da?a.start():R.debugMode&&console.log("skip midroll fetch")}),_.length&&_[0]>0||aa.length&&aa[0]>0){var l=!1,m=K.getSection("midroll");m&&m.forEach(function(a){var b=a.getAd();(b.pointP&&~_.indexOf(b.pointP)||b.point&&~aa.indexOf(b.point))&&(l=!0)}),l&&R.cb("adMidrollPoint",[a])}}}function h(a){function b(a,b){var c=a.getAd(),d=b.getAd();return(c.point||c.pointP*Q/100)-(d.point||d.pointP*Q/100)}var c=[];return a&&a.forEach(function(a){var b=a.getAd();(b.pointP&&~_.indexOf(b.pointP)||b.point&&~aa.indexOf(b.point))&&c.push(a)}),Z.forEach(function(a,b){~aa.indexOf(a)&&(Z[b]=-Z[b])}),$.forEach(function(a,b){~_.indexOf(a)&&($[b]=-$[b])}),c.sort(b),c}function i(){R.cb("onSkipped"),N&&(N.log("closedByUser"),N.skip(c))}function j(){N&&(N.log("playbackPaused"),N.pause())}function k(){N&&(N.log("playbackResumed"),N.resume())}function l(a){a=a<0?0:a>1?1:a,N&&N.setVolume(a)}function m(){N&&N.log("fullscreenOn")}function n(){N&&N.log("fullscreenOff")}function o(){b()}function p(a,b){R.callbacks[a]=b}function q(a){var b=[],c=K.getSection(a||"preroll");return c&&c.forEach(function(a){a.isEmpty()||b.push(a.getExtendedAdForApp())}),b}function r(a){return K.getAfterServices(a||"preroll")}function s(a,b){a.isEmpty()||a.isStat()||ca[b]&&ca[b].push(a)}function t(a){return(a.right-a.left)*(a.bottom-a.top)}function u(a,b){return{left:a.left+b.left,right:a.right+b.left,top:a.top+b.top,bottom:a.bottom+b.top}}function v(a){return a&&!isNaN(a)?a:null}function w(a,b){var c=a.document,d="width"===b?"clientWidth":"clientHeight",e="width"===b?"innerWidth":"innerHeight",f=a[e],g=c.body[d],h=c.documentElement[d],i=1/0;return i=v(g)||i,i=v(h)||i,Boolean(f)&&!isNaN(f)&&(i=Math.min(i,f)),i}function x(a){return{width:w(a,"width"),height:w(a,"height")}}function y(a,b){var c=x(b);return{left:Math.max(0,a.left),right:Math.min(c.width,a.right),top:Math.max(0,a.top),bottom:Math.min(c.height,a.bottom)}}function z(a,b){try{for(var c=a.getBoundingClientRect(),d=t(c),e=b,f=e.parent;e!==f;){var g=e.frameElement.getBoundingClientRect();c=u(c,g);var h=Math.max(g.left,c.left),i=Math.min(g.right,c.right),j=Math.max(g.top,c.top),k=Math.min(g.bottom,c.bottom);c.left=h,c.right=i<h?h:i,c.top=j,c.bottom=k<j?j:k,e=e.parent}c=y(c,f);var l=t(c);return{left:c.left,right:c.right,top:c.top,bottom:c.bottom,percent:l/d*100}}catch(a){return{left:0,right:0,top:0,bottom:0,percent:0}}}function A(){return window.hasOwnProperty("IntersectionObserver")}function B(a){try{if(a===a.top)return"ON_PAGE";for(var b=a;b!==b.parent;){if(b.document.domain!==b.parent.document.domain)return"XD_FRAME";b=b.parent}return"S_FRAME"}catch(a){}return"XD_FRAME"}function C(a){return!A(a)&&"XD_FRAME"!==B(a)}function D(a,b,c){H(c,z(a,window).percent>=100*b)}function E(a){return a.mozVisibilityState?"mozvisibilitychange":a.webkitVisibilityState?"webkitvisibilitychange":a.visibilityState?"visibilitychange":""}function F(a){H(a,!0)}function G(a){H(a,!1)}function H(a,b){var c=a.getPlayStatus();a.prevVisibility!==b&&(a.prevVisibility=b,void 0!==c.curStatus&&c.curStatus!==c.prevStatus&&(b?a.resume():a.pause()))}function I(a){var b=a,c=R.viewabilityValue,d=R.viewabilityEl;if(d)if(A()){var e=new IntersectionObserver(function(a){a.forEach(function(a){H(b,a.intersectionRatio>=c)})},{threshold:[.1,.2,.3,.4,.5,.6,.7,.8,.9,1]});e.observe(d)}else if(C){var f=function(){D(d,c,b)};window.addEventListener("resize",f,!1),window.addEventListener("scroll",f,!1)}var g=(E(document),function(){G(b)}),h=function(){F(b)};window.top.addEventListener("blur",g,!1),window.top.addEventListener("focus",h,!1)}function J(){return void 0===R.playStatus?{prevStatus:void 0,curStatus:void 0}:R.playStatus}var K,L,M,N,O,P,Q,R={version:"2.1.75",debugMode:!0,callbacks:{},cb:function(a,d){switch(a){case"onCompleted":N&&(N.complete=!0),c();break;case"onError":N&&(N.error=!0),c();break;case"onClosed":b(!0);break;default:var e=R.callbacks[a];e&&e.apply(this,d)}}},S="http:"===window.location.protocol?"http:":"https:",T=S+"//ad.mail.ru/static/admanhtml/2.1.75/vpaid-js-interface.swf",U=S+"//r.mradx.net/img/67/60047C.htm",V=new AdmanHTML.Stats(R),W=new AdmanHTML.Viewability,X=[],Y=[],Z=[],$=[],_=[],aa=[],ba={},ca={},da=3;R.stats=V,R.viewability=W,R.protocol=S;var ea={};return{init:a,start:d,stop:o,pause:j,resume:k,setVolume:l,fullscreenOn:m,fullscreenOff:n,setFullscreen:function(a){a?m():n()},skip:i,destroy:o,getPlayStatus:J,getSlot:function(){return R.slotId},setSlot:function(a){R.slotId=a},getVersion:function(){return R.version},getBannersForSection:q,getServicesForSection:r,hasSection:function(a){return a=a||"preroll",!(!q(a).length&&!r(a).length)},setDebug:function(a){R.debugMode=a},setPosition:g,onReady:p.bind(this,"onReady"),onError:p.bind(this,"onError"),onStarted:p.bind(this,"onStarted"),onPaused:p.bind(this,"onPaused"),onPlayed:p.bind(this,"onPlayed"),onCompleted:p.bind(this,"onCompleted"),onClosed:p.bind(this,"onClosed"),onSkipped:p.bind(this,"onSkipped"),onClicked:p.bind(this,"onClicked"),onTimeRemained:p.bind(this,"onTimeRemained"),onDurationChanged:p.bind(this,"onDurationChanged"),adMidrollPoint:p.bind(this,"adMidrollPoint"),_onVPAIDStarted:p.bind(this,"onVPAIDStarted"),research:{pause:function(){P&&P.pause()},resume:function(){P&&P.resume()},complete:function(){P&&P.setComplete()},setVolume:function(a){P&&P.setVolume(a)},setFullscreen:function(a){P&&P.setFullscreen(a)},setPosition:function(a,b){P&&P.setPosition(a,b)}}}},AdmanHTML.Ad=function(a,b){"use strict";function c(a){a&&a.forEach(function(a){d(a.url,a.type,a)})}function d(a,c,d){var e,f,g,h;if(a){try{a=decodeURIComponent(a)}catch(a){}if("playheadReachedValue"===c)void 0!==d.thresholdValue||void 0!==d.value?(e=parseInt(d.thresholdValue||d.value,10),b.stats.push({name:"thresholdValue",value:e,type:"thresholdValue."+e,url:a})):void 0===d.thresholdPValue&&void 0===d.pvalue||(e=parseInt(d.thresholdPValue||d.pvalue,10),b.stats.push({name:"thresholdPValue",value:e,type:"thresholdPValue."+e,url:a}));else if("playheadViewabilityValue"===c){var i=parseInt(d.viewablePercent,10),j=void 0===d.ovv&&void 0===d.mrc||(!!d.ovv||!!d.mrc),k="";g=void 0!==d.startTimer?parseInt(d.startTimer,10):0,h=void 0!==d.endTimer?parseInt(d.endTimer,10):0,i=isNaN(i)?50:i,void 0!==d.value?(e=parseInt(d.value,10),f="ovvValue"):void 0!==d.pvalue?(e=parseInt(d.pvalue,10),f="ovvPValue"):void 0!==d.duration&&(e=parseInt(d.duration,10),f="mrcValue",j||(k=d.unload?"unload":"complete")),b.stats.push({name:f,value:e,url:a,percent:i,viewable:j,start:g,end:h,onevent:k})}else if("playheadTimerValue"===c){g=void 0!==d.startTimer?parseInt(d.startTimer,10):0,h=void 0!==d.endTimer?parseInt(d.endTimer,10):0;var l=void 0!==d.rate?parseInt(d.rate,10):1;b.stats.push({name:"timerValue",rate:l,url:a,start:g,end:h})}else b.stats.push({name:c,type:c,url:a})}}function e(a){b.click=a,b.ad&&(b.ad.urlToNavigateOnClick=a)}function f(a,c){b.extensions[a]=c}function g(a,c,d){!d&&a in b.immutables||(b.immutables[a]=c)}function h(a){b.settings=b.settings||{},AdmanHTML.Utils.deepExtend(b.settings,a)}function i(c){function d(a){var b=a.type||"";return!(~b.indexOf("video")&&"video/mp4"!==b||~b.indexOf("audio")&&"audio/mp3"!==b&&"audio/mpeg"!==b)}function e(){a.stats.rb(a.stats.code.UNKNOWN_ADV_TYPE),a.stats.logError("UNKNOWN_ADV_TYPE")}if(b.ad=c,b.click&&(b.ad.urlToNavigateOnClick=b.click),AdmanHTML.Utils.mixin(b.ad,b.extensions),AdmanHTML.Utils.mixin(b.ad,b.immutables),b.ad.mediafiles&&b.ad.mediafiles.length){var f;b.ad.mediafiles.forEach(function(b){d(b)&&(!f||Math.abs(parseInt(b.height)-a.quality)<Math.abs(parseInt(f.height)-a.quality))&&(f=b)}),f&&AdmanHTML.Utils.mixin(b.ad,f)}delete b.ad.statistics,delete b.ad.mediafiles;var g,h;switch(b.ad.type){case"swf":case"application/x-shockwave-flash":if(h=b.ad.apiFramework||b.ad.api,a.browser.mobile||h&&"VPAID"!==h)return e(),!1;g=h?new AdmanHTML.VpaidSwfAdRenderer(a,this):new AdmanHTML.SwfAdRenderer(a,this);break;case"javascript":case"application/javascript":if((h=b.ad.apiFramework||b.ad.api)&&"VPAID"!==h)return e(),!1;g=new AdmanHTML.VpaidJsAdRenderer(a,this);break;case"video":case"video/mp4":g=new AdmanHTML.VideoAdRenderer(a,this);break;case"audio":case"audio/mp3":case"audio/mpeg":g=new AdmanHTML.AudioAdRenderer(a,this);break;case"image":case"image/bmp":case"image/gif":case"image/jpeg":case"image/png":g=new AdmanHTML.ImgAdRenderer(a,this);break;case"text":g=new AdmanHTML.TextAdRenderer(a,this);break;case"html":g=new AdmanHTML.HtmlAdRenderer(a,this);break;case"empty":g=new AdmanHTML.EmptyAdRenderer(a,this);break;case"statistics":g=new AdmanHTML.StatisticsAdRenderer(a,this);break;case"debugData":g=new AdmanHTML.DebugAdRenderer(a,this);break;case"research":g=new AdmanHTML.ResearchAdRenderer(a,this);break;case"video/x-flv":default:return e(),!1}return b.renderer=g,!0}function j(){return new AdmanHTML.Ad(a,JSON.parse(JSON.stringify(b)))}function k(){this.started&&(b.ad&&i.call(this,b.ad),this.disposed=!1,this.completed=!1,this.error=!1,this.started=!1),b.statsBackup?b.stats=b.statsBackup.slice():b.statsBackup=b.stats.slice()}function l(b,c,d){var e=b.url;e=e.replace("{requesthostname}",a.location.hostnameEncoded||""),AdmanHTML.Utils.loadImg(e);var f=c.indexOf(b);~f&&d&&c.splice(f,1)}function m(a,b){var c=b.indexOf(a);~c&&b.splice(c,1)}function n(a,c){function d(a){a=25*Math.floor(a/25);var b=t["thresholdPValue."+a];b&&(f=f.concat(b))}var e=a+(void 0===c?"":"."+c),f=t[e]?t[e].slice(0):[];f.push(e);var g=b.stats.slice(0);"thresholdPValue"===a&&d(c);var h="thresholdPValue"===a||"thresholdValue"===a||"closedByUser"===a;b.stats.forEach(function(b){"thresholdPValue"===a&&"thresholdPValue"===b.name&&b.value<c?l(b,g,h):"thresholdValue"===a&&"thresholdValue"===b.name&&b.value<c&&l(b,g,h),~f.indexOf(b.type)&&l(b,g,h)}),b.stats=g}function o(a,c){function d(a,b){b[Math.ceil(a.percent/10)].duration>1e3*a.value?a.viewable?l(a,f,!0):m(a,f):g++}function e(a){a.viewable||a.onevent===c&&l(a,f,!0)}var f=b.stats.slice(0),g=0,h=a&&a.length?d:e;return b.stats.forEach(function(b){"mrcValue"===b.name&&h(b,a)}),b.stats=f,g}function p(c,d){var e,f,g=b.stats.slice(0);b.stats.forEach(function(b){("ovvValue"===b.name&&b.value<=c||"ovvPValue"===b.name&&b.value<=d)&&(e=e||a.viewability.getViewabilityState(),f=e.percent>b.percent&&e.focus,"UNDETERMINED"!==e.state&&(f&&b.viewable||!f&&!b.viewable)&&AdmanHTML.Utils.loadImg(b.url),m(b,g))}),b.stats=g}function q(a,c){b.renderer&&b.renderer[a]&&b.renderer[a](c)}function r(){var a={};return a="audio"===b.ad.type||"audio/mp3"===b.ad.type||"audio/mpeg"===b.ad.type?{allowSeek:!1,allowSkip:!1,allowTrackChange:!1,allowVolumeChange:!1}:b.settings?{allowClose:!b.settings.hasOwnProperty("allowClose")||b.settings.allowClose,allowCloseDelay:b.settings.hasOwnProperty("allowCloseDelay")?b.settings.allowCloseDelay:0}:{allowClose:!0,allowCloseDelay:0},AdmanHTML.Utils.mixin(a,b.ad),a}function s(){var a=r();return a.statistics=b.stats.slice(0),a}b=b||{stats:[],extensions:{},immutables:{}};var t={closedByUser:["close","skipAd"],click:["addClick"],"thresholdPValue.25":["firstQuartile"],"thresholdPValue.50":["secondQuartile","midpoint"],"thresholdPValue.75":["thirdQuartile"],"thresholdPValue.100":["fourthQuartile"],playbackStarted:["start"],playbackCompleted:["complete"],volumeOff:["mute"],volumeOn:["unmute"],playbackPaused:["pause"],playbackResumed:["resume"],fullscreenOn:["fullscreen"],error:["Error"]};return{addStatCollection:c,addStat:d,addClick:e,addExtension:f,addImmutableProperty:g,addSettings:h,getSettings:function(){return b.settings},addAd:i,getAd:function(){return b.ad},getAdForApp:r,getExtendedAdForApp:s,isEmpty:function(){return"empty"===b.ad.type},isStat:function(){return"statistics"===b.ad.type},clone:j,reset:k,log:n,logMRC:o,logOVV:p,start:q.bind(this,"start"),dispose:q.bind(this,"dispose"),pause:q.bind(this,"pause"),resume:q.bind(this,"resume"),setVolume:q.bind(this,"setVolume"),setFullscreen:q.bind(this,"setFullscreen"),setComplete:q.bind(this,"setComplete"),skip:q.bind(this,"skip"),setPosition:function(a,c){b.renderer&&b.renderer.setPosition&&b.renderer.setPosition(a,c)},complete:!1,error:!1}},AdmanHTML.AdSlot=function(a,b,c){"use strict";function d(b,c,d,f,i,j){function k(k){var l={};--t,k&&(u++,k="string"==typeof k?k.trim():k,"object"==typeof k||"{"===k.charAt(0)?(l=g(k,b,c,d||0,f,i,j),v++):"<"===k.charAt(0)?(l=h(k,b,c,d||0,f,i,j),v++):(a.stats.rb(a.stats.code.UNKNOWN_DATA_FORMAT),a.stats.logError("UNKNOWN_DATA_FORMAT"))),b.id&&(l.banners||l.services?l.banners&&y.markNonEmptyService(b.id):y.markEmptyService(b.id)),e(j)}if(d&&d>4)return void e(j);var l=y.getService(b.id);l&&l.log("serviceRequested"),++t,b.url?(-1!==b.url.indexOf("ad.mail.ru/")&&-1===b.url.indexOf("version="+a.version)&&(b.url+=-1===b.url.indexOf("?")?"?":"&",b.url+="version="+a.version),AdmanHTML.Utils.xhr(b.url,k)):b.data&&setTimeout(k,0,b.data)}function e(b){if(!t){if(u&&v){var d=y.getNextOnEmptyService();if(d)return void d.start(e.bind(null,b));n();var g=b||c;return g.called||(g.called=!0,g()),void(a.debugMode&&console.log(p))}f()}}function f(){var b=a.callbacks.onError;b&&b()}function g(b,c,e,f,g,h,n){function o(a){return a?a.filter(function(a){return a.type&&("sectionShown"===a.type||"sectionStarted"===a.type||"sectionEmpty"===a.type)}):[]}function q(b,g,h,l){var m=e?e.clone():new AdmanHTML.Ad(a);if(m.addStatCollection(b.statistics),m.addStatCollection(b.serviceStatistics),"additionalData"===b.type){var o;b.id=b.id||AdmanHTML.Utils.createIntUID(),u.services++;var q=!p[h]||0===p[h].length;if(g>0&&q&&(x[h]=!0),b.extensions)for(var r in b.extensions)b.extensions.hasOwnProperty(r)&&i(m,b.extensions[r],r);if(["point","pointP","hasVolume","hasPause","allowClose","allowCloseDelay","allowSeek","allowSkip","allowTrackChange","allowVolumeChange"].forEach(function(a){a in b&&m.addImmutableProperty(a,b[a])}),"true"===b.doAfter||!0===b.doAfter||b.doOnEmptyResponseFromId){var s="true"===b.doAfter||!0===b.doAfter?w.POST:null,t=function(a,c){d(b,a||m,b.allowRepeat?0:f+1,h,s,function(){c&&c()})};o=new AdmanHTML.ServiceAd(a,null,t),k(h,c.id,o,b,m)}else o=new AdmanHTML.ServiceAd(a),k(h,c.id,o,b),0===g&&q?d(b,m,f+1,h,w.PRE,n):d(b,m,f+1,h,null,n)}else j(h,l,m,b),u.banners++;return m}var s,t=b,u={banners:0,services:0};if("string"==typeof b)try{t=JSON.parse(b)}catch(b){return a.stats.rb(a.stats.code.ERROR_CONVERTING_STRING_TO_JSON),void a.stats.logError("ERROR_CONVERTING_STRING_TO_JSON")}t.settings&&t.settings.requestHostname&&!r.requestHostname&&(r.requestHostname=t.settings.requestHostname);for(var v in t.sections)if(t.sections.hasOwnProperty(v)){var y=t.sections[v],z=0;if(t.settings&&(s=t.settings[v])&&(s.controlsStyle=t.settings.controlsStyle||0,m(v,s)),y.forEach(function(b){if("debugData"===b.type){var c=new AdmanHTML.Ad(a);return c.addClick(b.url),void l(v,c,b)}var d=g===v?h:"",e=q(b,z,v,d);s&&(e.addStatCollection(o(s.statistics)),e.addSettings(s)),z++}),0===y.length){var A=new AdmanHTML.Ad(a);s&&A.addStatCollection(o(s.statistics)),j(v,"",A,{type:"empty"})}}return t.type&&q(t,0,g,h),u}function h(b,c,e,f,g,h,k){function l(a,b,c){n(a.getElementsByTagName(b),c)}function m(a,b,c,d){l(a,b,function(a){d(p(a),c?o(a,c):null,a)})}function n(a,b){Array.prototype.forEach.call(a,b.bind(this))}function o(a,b){var c=a.attributes.getNamedItem(b);return c?c.value:null}function p(a){return a&&a.childNodes&&a.childNodes[0]&&a.childNodes[0].wholeText?a.childNodes[0].wholeText.trim():null}var q,r={banners:0,services:0};try{q=AdmanHTML.Utils.parseXml(b)}catch(b){return a.stats.rb(a.stats.code.ERROR_CONVERTING_STRING_TO_XML),void a.stats.logError("ERROR_CONVERTING_STRING_TO_XML")}return l(q,"Ad",function(b){function q(c){var d=e?e.clone():new AdmanHTML.Ad(a);m(b,"Impression","id",function(a){try{d.addStat(a,"playbackStarted")}catch(a){}}),m(b,"Extension","type",function(a,b){i(d,a,b)}),m(b,"Error",null,function(a){d.addStat(a,"error")}),m(c,"Tracking","event",d.addStat);var f=c.getElementsByTagName("VideoClicks")[0];return f&&n(f.childNodes,function(a){"ClickThrough"===a.tagName?d.addClick(p(a)):"ClickTracking"===a.tagName&&d.addStat(p(a),"click")}),d}function s(a){var b={width:o(a,"width"),height:o(a,"height"),id:o(a,"id"),assetWidth:o(a,"assetWidth"),assetHeight:o(a,"assetHeight"),expandedWidth:o(a,"expandedWidth"),expandedHeight:o(a,"expandedHeight"),apiFramework:o(a,"apiFramework"),adSlotID:o(a,"adSlotID"),statistics:[]};return m(a,"StaticResource",null,function(a){b.staticResource=a}),m(a,"HTMLResource",null,function(a){b.htmlResource=a}),m(a,"IFrameResource",null,function(a){b.iframeResource=a}),m(a,"CompanionClickTracking",null,function(a){b.statistics.push({type:"click",url:a})}),m(a,"Tracking","event",function(a,c){b.statistics.push({type:c,url:a})}),m(a,"CompanionClickThrough",null,function(a){b.urlToNavigateOnClick=a}),b}var t=o(b,"id");l(b,"InLine",function(a){var b=[];l(a,"CompanionAds",function(c){var d=o(c,"required")||"none";l(a,"Companion",function(a){var c=s(a);c.required=d,b.push(c)})}),l(a,"Linear",function(a){var d,e=q(a),f=a.parentNode;f&&(d=o(f,"adId")||o(f,"adID")||o(f,"AdId")||o(f,"AdID")||o(f,"id")),d=d||t;var i={bannerID:d,mediafiles:[],duration:AdmanHTML.Utils.convertDuration(p(a.getElementsByTagName("Duration")[0]))};c.urlToNavigateOnClick&&(i.urlToNavigateOnClick=c.urlToNavigateOnClick),l(a,"MediaFile",function(a){i.mediafiles.push({apiFramework:o(a,"apiFramework"),type:o(a,"type"),width:o(a,"width"),height:o(a,"height"),src:p(a)})}),l(a,"AdParameters",function(a){i.params=p(a)}),b.length&&(i.companionAds=b),j(g||"preroll",h,e,i),r.banners++}),l(a,"NonLinear",function(a){var b=q(a),c={width:o(a,"width"),height:o(a,"height"),duration:AdmanHTML.Utils.convertDuration(o(a,"minSuggestedDuration")),mediafiles:[]};m(a,"NonLinearClickThrough",null,function(a){b.addStat(a,"click")}),m(a,"StaticResource","creativeType",function(a,b){c.mediafiles.push({type:b,src:a})}),j(g||"overlay",h,b,c),r.banners++})}),l(b,"VASTAdTagURI",function(a){r.services++,d({url:p(a),id:c.id},q(b),f+1,g,h,k)})}),r}function i(a,b,c){"controls"===c?a.addExtension("showControls",Boolean(parseInt(b,10))):"skipTime2"===c?(b=isNaN(b)?AdmanHTML.Utils.convertDuration("00:"+b):parseInt(b,10),a.addExtension("allowCloseDelay",b)):"linkTxt"===c&&(a.addExtension("linkText",b),a.addExtension("adText",b))}function j(a,b,c,d){c.addAd(d)&&(c.sectionType=a,b===w.PRE&&x[a]&&(b=""),a=(b||"")+a,p[a]=p[a]||[],p[a].push(c))}function k(a,b,c,d,e){c.addAd(d),c.addInheritedAd(e),c.addStatCollection(d.statistics),c.addStatCollection(d.serviceStatistics),c.sectionType=a,y.addService(c,b)}function l(a,b,c){b.addAd(c)&&(b.section=a,s[a]=b)}function m(a,b){q[a]=q[a]||{},AdmanHTML.Utils.mixin(q[a],b),delete q[a].statistics,delete q[a].view,delete q[a].advertisment}function n(){"preroll midroll pauseroll overlay postroll claimroll".split(" ").forEach(function(a){var b=x[a]?p[a]:p[w.PRE+a],c=x[a]?p[w.PRE+a]:p[a],d=p[w.POST+a];p[a]=[].concat(b||[],c||[],d||[]),o(w.PRE+a),o(w.POST+a)})}function o(a){p[a]=[]}var p={},q={},r={},s={},t=0,u=0,v=0,w={PRE:"pre-",POST:"post-"},x={},y=new AdmanHTML.ServiceStorage;return d({url:b.url,data:b.data}),{getSection:function(a){return p[a]},getAfterServices:y.getAfterServices,getNextAfterService:y.getNextAfterService,resetServices:y.resetAll,getServices:y.getServices,removeService:y.removeService,getSettings:function(a){return q[a]||{}},getRootSettings:function(){return r},getDebug:function(a){return s[a]}}},AdmanHTML.ServiceAd=function(a,b,c){"use strict";function d(a){return b.ad=a,!0}function e(a){b.inheritedAd=a}function f(a,c){b.inheritedAd.addImmutableProperty(a,c,!0)}function g(a){var b=a?a.filter(function(a){return"serviceRequested"===a.type||"serviceAnswerEmpty"===a.type}):[];b&&b.forEach(function(a){h(a.url,a.type,a)})}function h(a,c){a=decodeURIComponent(a),b.stats.push({name:c,type:c,url:a})}function i(a){m=!0,c&&c(b.inheritedAd,a)}function j(){m=!1}function k(){return!(!b.ad||!b.ad.doAfter)&&(!0===b.ad.doAfter||"true"===b.ad.doAfter)}function l(a){function c(a){AdmanHTML.Utils.loadImg(a.url);var b=d.indexOf(a);~b&&d.splice(b,1)}var d=b.stats.slice(0);b.stats.forEach(function(b){b.type===a&&c(b)}),b.stats=d}b=b||{stats:[]};var m=!1;return{addStatCollection:g,addStat:h,addAd:d,addInheritedAd:e,addImmutableProperty:f,getAd:function(){return b.ad},start:i,reset:j,started:function(){return m},log:l,isAfter:k}},AdmanHTML.ServiceStorage=function(){"use strict";function a(a,b){var c=a.getAd();m.push(c.id),l[c.id]={service:a},b&&l[b]&&(l[b].children=l[b].children||[],l[b].children.push(c.id)),("true"===c.doAfter||!0===c.doAfter||c.doOnEmptyResponseFromId)&&k.push(a)}function b(a){return l[a]?l[a].service:null}function c(a){var b="string"==typeof a||"number"==typeof a?a:a.getAd().id;delete l[b];var c,d;for(c=0,d=k.length;c<d;c++)if(a=k[c],a.getAd().id===b){k.splice(c,1);break}}function d(a,b){if(!a)return[];var c,d,e=[];for(c in l)l.hasOwnProperty(c)&&(d=l[c].service,d.sectionType!==a||b&&!b(d)||e.push(d));return e}function e(a){var b,c,d,e;for(b=m.length-1;b>=0;b--)if(c=m[b],l[c])if(d=l[c].service,c===a)d.log("serviceAnswerEmpty"),m.splice(b,1),n.push(a),delete l[c];else{if(!(e=l[c].children))continue;-1!==e.indexOf(a)&&e.splice(e.indexOf(a),1),0===e.length&&(a=c,b++)}}function f(a){var b=l[a];b&&(b.children=null)}function g(){var a,b,c,d;for(a=0,b=k.length;a<b;a++)if(c=k[a],(d=c.getAd().doOnEmptyResponseFromId)&&-1!==n.indexOf(d)&&!c.isAfter())return k.splice(a,1),c;return null}function h(a){if(!a)return[];var b,c,d,e=[];for(b=0,c=k.length;b<c;b++)d=k[b],d.sectionType===a&&d.isAfter()&&!d.started()&&e.push(d);return e}function i(a){if(!a)return null;var b,c,d,e;for(b=0,c=k.length;b<c;b++)if(d=k[b],d.sectionType===a&&d.isAfter()&&!d.started()){if((e=d.getAd().doOnEmptyResponseFromId)&&-1===n.indexOf(e))continue;return d.getAd().allowRepeat||k.splice(b,1),d}return null}function j(a){var b,c,d;for(b=0,c=k.length;b<c;b++)d=k[b],a&&d.sectionType!==a||d.reset()}var k=[],l={},m=[],n=[];return{addService:a,getService:b,getServices:d,removeService:c,resetAll:j,markEmptyService:e,markNonEmptyService:f,getAfterServices:h,getNextAfterService:i,getNextOnEmptyService:g}},"function"==typeof define&&define.amd&&define(function(){"use strict";return AdmanHTML}),AdmanHTML.VpaidLoader=function(){"use strict";function a(a,b){this.id=Math.round(1e6*Math.random()),this.video=a,this.videoIsElement=AdmanHTML.Utils.isElement(this.video),this._props={},this.autoMuted=!1,this.win=b||window}var b=300;return a.prototype.load=function(a,b){var c=document.createElement("iframe");return this.adframe=c,this.src=a,c.width="100%",c.height="100%",c.scrolling="no",c.marginWidth="0",c.marginHeight="0",c.frameBorder="0",c.src=b,c.id="ad-frame-"+this.id,c.setAttribute("allow","autoplay"),c.onload=function(){this.send({type:"vpaid",method:"load",src:this.src,urlToNavigateOnClick:this.urlToNavigateOnClick})}.bind(this),this.processMessage=this.processMessage.bind(this),this.videoEventHandler=this.videoEventHandler.bind(this),this.videoEvents=["play","pause","volumechange","timeupdate","ended"],this.video.addEventListener("play",this.videoEventHandler),this.video.addEventListener("pause",this.videoEventHandler),this.video.addEventListener("volumechange",this.videoEventHandler),this.video.addEventListener("timeupdate",this.videoEventHandler),this.video.addEventListener("ended",this.videoEventHandler),this.win.addEventListener("message",this.processMessage),c},a.prototype.processMessage=function(a){if(a.source===this.adframe.contentWindow)try{var b=JSON.parse(a.data);switch(this.urlToNavigateOnClick&&(b.urlToNavigateOnClick=this.urlToNavigateOnClick),b.type){case"video":this.videoMessageHandler(b);break;case"vpaid":this.vpaidMessageHandler(b)}}catch(a){}},a.prototype.videoMessageHandler=function(a){switch(a.src&&a.src.replace(/https?:/,"")!==this.video.src.replace(/https?:/,"")&&(this.video.src=a.src),a.method){case"load":this.video.load();break;case"play":var c=this.video.play();c.then&&c.then(function(){this.video.muted&&!this.autoMutedTS&&(this.autoMutedTS=(new Date).getTime())}.bind(this),function(){this.autoMuted=!0,this.autoMutedTS=(new Date).getTime(),this.video.muted=!0,this.video.volume=0,this.videoEventHandler({type:"volumechange"}),this.callSet("adVolume",0),this.video.play()}.bind(this));break;case"pause":this.video.pause();break;case"muted":if(!a.value&&this.video.muted&&this.autoMutedTS&&(new Date).getTime()-this.autoMutedTS<b)return;this.mutedByVPAID=a.value,this.video.muted=a.value;break;case"volume":a.value&&this.video.muted&&!this.mutedByVPAID?!this.autoMutedTS||(new Date).getTime()-this.autoMutedTS>b?(this.video.muted=!1,this.video.volume=a.value):this.callSet("adVolume",0):(this.video.volume=a.value,0===a.value&&(this.video.muted=!0));break;case"addEventListener":this.videoEvents=this.videoEvents||[],this.videoEvents.push(a.eventType),this.video.addEventListener(a.eventType,this.videoEventHandler)}},a.prototype.videoEventHandler=function(a){this.send({type:"video",method:"emit",eventType:a.type,currentTime:this.video.currentTime,duration:this.video.duration,volume:this.video.volume,muted:this.video.muted}),this.videoIsElement&&("play"===a.type?this.onVpaidCallback("video:play"):"pause"===a.type&&this.video.currentTime>0&&this.video.currentTime<.99*this.video.duration&&this.onVpaidCallback("video:pause"))},a.prototype.vpaidMessageHandler=function(a){AdmanHTML.Utils.mixin(this._props,a.props),"function"==typeof this.onVpaidCallback&&this.onVpaidCallback(a.eventType,a.props)},a.prototype.call=function(a,b){var c={type:"vpaid",method:a};if(b&&(c.params=b),this.send(c),a in this._props)return this._props[a]},a.prototype.callGet=function(a){return this._props[a]},a.prototype.callSet=function(a,b){return a="set"+a.charAt(0).toUpperCase()+a.slice(1),this.call(a,[b])},a.prototype.send=function(a){this.adframe&&(a.id=this.id,this.adframe.contentWindow&&this.adframe.contentWindow.postMessage(JSON.stringify(a),"*"))},a.prototype.onVpaidEvent=function(a){this.onVpaidCallback=a},a.prototype.destroy=function(){if(this.adframe&&this.adframe.parentNode&&this.adframe.parentNode.removeChild(this.adframe),this.videoEvents&&this.videoEvents.length)for(var a=0,b=this.videoEvents.length;a<b;a++)this.video.removeEventListener(this.videoEvents[a],this.videoEventHandler);this.video.pause(),this.video.src="",this.autoMuted&&(this.video.muted=!1),this.adframe=null,this.win.removeEventListener("message",this.processMessage),this.win=null},a}(),AdmanHTML.Stats=function(a){"use strict";function b(a){if(i){var b=k[a];b&&d("https://r.mail.ru/d"+b+".gif?rnd="+Math.random())}else j.push(a)}function c(b){var c=AdmanHTML.Utils.getPageLocation();-1===AdmanHTML.Utils.getHostname(c||"").indexOf("localhost")&&d("https://ad.mail.ru/admanhtml/?app=admanhtml&ver="+a.version+"&error="+encodeURI(b)+"&slot="+a.slotId),a.debugMode&&console&&console.warn&&console.warn("Error: "+b)}function d(a){AdmanHTML.Utils.loadImg(a)}function e(a){if(!h){var c="https://ad.mail.ru/vp/"+g+"?original="+(a.slot||"")+"&version="+a.version;h=!0;var d=AdmanHTML.Utils.getPageLocation();-1===AdmanHTML.Utils.getHostname(d||"").indexOf("localhost")?AdmanHTML.Utils.xhr(c,function(a){if(i=!0,a){if("string"==typeof a)try{k=JSON.parse(a.trim())}catch(a){}else"object"==typeof a&&(k=a);var c=j.slice();j=[],c.forEach(b)}
}):(console.log(c),i=!0)}}var f="slot",g=3107,h=!1,i=!1,j=[],k={};return{rb:b,logError:c,simple:d,initMode:function(a,b){f=a,"slot"===a&&e(b)},code:{ADMAN_INSTANCE_CREATED:"ADMAN_INSTANCE_CREATED",ADMAN_SUCCESSFULLY_INITIALIZED:"ADMAN_SUCCESSFULLY_INITIALIZED",ERROR_CONVERTING_STRING_TO_JSON:"ERROR_CONVERTING_STRING_TO_JSO